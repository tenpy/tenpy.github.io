
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>tenpy.tools.io &#8212; TeNPy 0.5.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="shortcut icon" href="../../../_static/logo.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">TeNPy 0.5.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../tenpy.html" accesskey="U">tenpy</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for tenpy.tools.io</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Tools to save and load data (from TeNPy) to disk.</span>

<span class="sd">The functions :func:`dump` and :func:`load` are convenience functions for saving and loading</span>
<span class="sd">quite general python objects (like dictionaries) to/from files, guessing the file type</span>
<span class="sd">(and hence protocol for reading/writing) from the file ending.</span>

<span class="sd">On top of that, this function provides support for saving python objects to [HDF5]_ files with</span>

<span class="sd">.. rubric:: Global module constants used for our HDF5 format</span>

<span class="sd">Names of HDF5 attributes:</span>

<span class="sd">.. autodata:: ATTR_TYPE</span>
<span class="sd">.. autodata:: ATTR_CLASS</span>
<span class="sd">.. autodata:: ATTR_MODULE</span>
<span class="sd">.. autodata:: ATTR_LEN</span>
<span class="sd">.. autodata:: ATTR_FORMAT</span>

<span class="sd">Names for the ``ATTR_TYPE`` attribute:</span>

<span class="sd">.. autodata:: REPR_HDF5EXPORTABLE</span>
<span class="sd">.. autodata:: REPR_NONE</span>
<span class="sd">.. autodata:: REPR_LIST</span>
<span class="sd">.. autodata:: REPR_SET</span>
<span class="sd">.. autodata:: REPR_TUPLE</span>
<span class="sd">.. autodata:: REPR_DICT</span>
<span class="sd">.. autodata:: REPR_DICT_SIMPLE</span>

<span class="sd">.. autodata:: TYPES_FOR_HDF5_DATASETS</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># Copyright 2020 TeNPy Developers, GNU GPLv3</span>

<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">gzip</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">importlib</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;dump&#39;</span><span class="p">,</span> <span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="s1">&#39;Hdf5FormatError&#39;</span><span class="p">,</span> <span class="s1">&#39;Hdf5ExportError&#39;</span><span class="p">,</span> <span class="s1">&#39;Hdf5ImportError&#39;</span><span class="p">,</span> <span class="s1">&#39;Hdf5Exportable&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Hdf5Saver&#39;</span><span class="p">,</span> <span class="s1">&#39;Hdf5Loader&#39;</span><span class="p">,</span> <span class="s1">&#39;dump_to_hdf5&#39;</span><span class="p">,</span> <span class="s1">&#39;load_from_hdf5&#39;</span>
<span class="p">]</span>


<div class="viewcode-block" id="dump"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.dump.html#tenpy.networks.site.dump">[docs]</a><span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Save `data` to file with given `filename`.</span>

<span class="sd">    This function guesses the type of the file from the filename ending.</span>
<span class="sd">    Supported endings:</span>

<span class="sd">    ======== ===============================</span>
<span class="sd">    ending   description</span>
<span class="sd">    ======== ===============================</span>
<span class="sd">    .pkl     Pickle without compression</span>
<span class="sd">    -------- -------------------------------</span>
<span class="sd">    .pklz    Pickle with gzip compression.</span>
<span class="sd">    -------- -------------------------------</span>
<span class="sd">    .hdf5    Hdf5 file (using `h5py`).</span>
<span class="sd">    ======== ===============================</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        The name of the file where to save the data.</span>
<span class="sd">    mode : str</span>
<span class="sd">        File mode for opening the file. ``&#39;w&#39;`` for write (discard existing file),</span>
<span class="sd">        ``&#39;a&#39;`` for append (add data to exisiting file).</span>
<span class="sd">        See :py:func:`open` for more details.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.pkl&#39;</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span> <span class="o">+</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.pklz&#39;</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span> <span class="o">+</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.hdf5&#39;</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">h5py</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">dump_to_hdf5</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Don&#39;t recognise file ending of &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span></div>


<div class="viewcode-block" id="load"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.load.html#tenpy.networks.site.load">[docs]</a><span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Load data from file with given `filename`.</span>

<span class="sd">    Guess the type of the file from the filename ending, see :func:`dump` for possible endings.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        The name of the file to load.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    data : obj</span>
<span class="sd">        The object loaded from the file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.pkl&#39;</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.pklz&#39;</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.hdf5&#39;</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">h5py</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">load_from_hdf5</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Don&#39;t recognise file ending of &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># =================================================================================</span>
<span class="c1"># everything below is for our export/import with our self-definded HDF5 format.</span>
<span class="c1"># =================================================================================</span>

<span class="c1">#: saved object is instance of a user-defined class following the :class:`Hdf5Exportable` style.</span>
<span class="n">REPR_HDF5EXPORTABLE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">(</span><span class="s2">&quot;instance&quot;</span><span class="p">)</span>

<span class="n">REPR_ARRAY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">(</span><span class="s2">&quot;array&quot;</span><span class="p">)</span>  <span class="c1">#: saved object represents a numpy array</span>
<span class="n">REPR_INT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>  <span class="c1">#: saved object represents a (python) int</span>
<span class="n">REPR_FLOAT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>  <span class="c1">#: saved object represnts a (python) float</span>
<span class="n">REPR_STR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">)</span>  <span class="c1">#: saved object represnts a (python) string</span>
<span class="n">REPR_COMPLEX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">(</span><span class="s2">&quot;complex&quot;</span><span class="p">)</span>  <span class="c1">#: saved object represents a complex number</span>
<span class="n">REPR_INT64</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">(</span><span class="s2">&quot;np.int64&quot;</span><span class="p">)</span>  <span class="c1">#: saved object represents a np.int64</span>
<span class="n">REPR_FLOAT64</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">(</span><span class="s2">&quot;np.float64&quot;</span><span class="p">)</span>  <span class="c1">#: saved object represents a np.float64</span>
<span class="n">REPR_INT32</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">(</span><span class="s2">&quot;np.int32&quot;</span><span class="p">)</span>  <span class="c1">#: saved object represents a np.int32</span>
<span class="n">REPR_FLOAT32</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">(</span><span class="s2">&quot;np.float32&quot;</span><span class="p">)</span>  <span class="c1">#: saved object represents a np.float32</span>

<span class="n">REPR_NONE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>  <span class="c1">#: saved object is ``None``</span>
<span class="n">REPR_RANGE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">(</span><span class="s2">&quot;range&quot;</span><span class="p">)</span>  <span class="c1">#: saved object is ``None``</span>
<span class="n">REPR_LIST</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">(</span><span class="s2">&quot;list&quot;</span><span class="p">)</span>  <span class="c1">#: saved object represents a list</span>
<span class="n">REPR_TUPLE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">(</span><span class="s2">&quot;tuple&quot;</span><span class="p">)</span>  <span class="c1">#: saved object represents a tuple</span>
<span class="n">REPR_SET</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">(</span><span class="s2">&quot;set&quot;</span><span class="p">)</span>  <span class="c1">#: saved object represents a set</span>
<span class="n">REPR_DICT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">(</span><span class="s2">&quot;dict&quot;</span><span class="p">)</span>  <span class="c1">#: saved object represents a dict with complicated keys</span>
<span class="n">REPR_DICT_SIMPLE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">(</span><span class="s2">&quot;simple_dict&quot;</span><span class="p">)</span>  <span class="c1">#: saved object represents a dict with simple keys</span>
<span class="n">REPR_DTYPE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">)</span>  <span class="c1">#: saved object represents a np.dtype</span>

<span class="c1">#: tuple of (type, type_repr) which h5py can save as datasets; one entry for each type.</span>
<span class="n">TYPES_FOR_HDF5_DATASETS</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span>
    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">REPR_ARRAY</span><span class="p">),</span>
    <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">REPR_INT</span><span class="p">),</span>
    <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">REPR_FLOAT</span><span class="p">),</span>
    <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">REPR_STR</span><span class="p">),</span>
    <span class="p">(</span><span class="nb">complex</span><span class="p">,</span> <span class="n">REPR_COMPLEX</span><span class="p">),</span>
    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span> <span class="n">REPR_INT64</span><span class="p">),</span>
    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">REPR_FLOAT64</span><span class="p">),</span>
    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">REPR_INT32</span><span class="p">),</span>
    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">REPR_FLOAT32</span><span class="p">),</span>
<span class="p">])</span>

<span class="n">ATTR_TYPE</span> <span class="o">=</span> <span class="s2">&quot;type&quot;</span>  <span class="c1">#: Attribute name for type of the saved object, should be one of the ``REPR_*``</span>
<span class="n">ATTR_CLASS</span> <span class="o">=</span> <span class="s2">&quot;class&quot;</span>  <span class="c1">#: Attribute name for the class name of an HDF5Exportable</span>
<span class="n">ATTR_MODULE</span> <span class="o">=</span> <span class="s2">&quot;module&quot;</span>  <span class="c1">#: Attribute name for the module where ATTR_CLASS can be retrieved</span>
<span class="n">ATTR_LEN</span> <span class="o">=</span> <span class="s2">&quot;len&quot;</span>  <span class="c1">#: Attribute name for the length of iterables, e.g, list, tuple</span>
<span class="n">ATTR_FORMAT</span> <span class="o">=</span> <span class="s2">&quot;format&quot;</span>  <span class="c1">#: indicates the `ATTR_TYPE` format used by :class:`Hdf5Exportable`</span>


<div class="viewcode-block" id="Hdf5FormatError"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5FormatError.html#tenpy.networks.site.Hdf5FormatError">[docs]</a><span class="k">class</span> <span class="nc">Hdf5FormatError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Common base class for errors regarding our HDF5 format.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="Hdf5ExportError"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5ExportError.html#tenpy.networks.site.Hdf5ExportError">[docs]</a><span class="k">class</span> <span class="nc">Hdf5ExportError</span><span class="p">(</span><span class="n">Hdf5FormatError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This exception is raised when something went wrong during export to hdf5.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="Hdf5ImportError"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5ImportError.html#tenpy.networks.site.Hdf5ImportError">[docs]</a><span class="k">class</span> <span class="nc">Hdf5ImportError</span><span class="p">(</span><span class="n">Hdf5FormatError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This exception is raised when something went wrong during import from hdf5.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="Hdf5Exportable"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Exportable.html#tenpy.networks.site.Hdf5Exportable">[docs]</a><span class="k">class</span> <span class="nc">Hdf5Exportable</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Interface specification for a class to be exportable to our HDF5 format.</span>

<span class="sd">    To allow a class to be exported to HDF5 with :func:`dump_to_hdf5`,</span>
<span class="sd">    it only needs to implement the :meth:`save_hdf5` method as documented below.</span>
<span class="sd">    To allow import, a class should implement the classmethod :meth:`from_hdf5`.</span>
<span class="sd">    During the import, the class already needs to be defined;</span>
<span class="sd">    loading can only initialize instances, not define classes.</span>

<span class="sd">    The implementation given works for sufficiently simple (sub-)classes, for which all data is</span>
<span class="sd">    stored in :attr:`~object.__dict__`.</span>
<span class="sd">    In particular, this works for python-defined classes which simply store data using</span>
<span class="sd">    ``self.data = data`` in their methods.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Hdf5Exportable.save_hdf5"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Exportable.html#tenpy.networks.site.Hdf5Exportable.save_hdf5">[docs]</a>    <span class="k">def</span> <span class="nf">save_hdf5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hdf5_saver</span><span class="p">,</span> <span class="n">h5gr</span><span class="p">,</span> <span class="n">subpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Export `self` into a HDF5 file.</span>

<span class="sd">        This method saves all the data it needs to reconstruct `self` with :meth:`from_hdf5`.</span>

<span class="sd">        This implementation saves the content of :attr:`~object.__dict__` with</span>
<span class="sd">        :meth:`~tenpy.tools.io.Hdf5Saver.save_dict_content`,</span>
<span class="sd">        storing the format under the attribute ``&#39;format&#39;``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        hdf5_saver : :class:`~tenpy.tools.io.Hdf5Saver`</span>
<span class="sd">            Instance of the saving engine.</span>
<span class="sd">        h5gr : :class`Group`</span>
<span class="sd">            HDF5 group which is supposed to represent `self`.</span>
<span class="sd">        subpath : str</span>
<span class="sd">            The `name` of `h5gr` with a ``&#39;/&#39;`` in the end.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># for new implementations, use:</span>
        <span class="c1">#   hdf5_saver.dump(data, subpath + &quot;key&quot;)  # for big content/data</span>
        <span class="c1">#   h5gr.attrs[&quot;name&quot;] = info               # for metadata</span>

        <span class="c1"># here: assume all the data is given in self.__dict__</span>
        <span class="n">type_repr</span> <span class="o">=</span> <span class="n">hdf5_saver</span><span class="o">.</span><span class="n">save_dict_content</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span> <span class="n">h5gr</span><span class="p">,</span> <span class="n">subpath</span><span class="p">)</span>
        <span class="n">h5gr</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">ATTR_FORMAT</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_repr</span></div>

<div class="viewcode-block" id="Hdf5Exportable.from_hdf5"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Exportable.html#tenpy.networks.site.Hdf5Exportable.from_hdf5">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_hdf5</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">hdf5_loader</span><span class="p">,</span> <span class="n">h5gr</span><span class="p">,</span> <span class="n">subpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load instance from a HDF5 file.</span>

<span class="sd">        This method reconstructs a class instance from the data saved with :meth:`save_hdf5`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        hdf5_loader : :class:`~tenpy.tools.io.Hdf5Loader`</span>
<span class="sd">            Instance of the loading engine.</span>
<span class="sd">        h5gr : :class:`Group`</span>
<span class="sd">            HDF5 group which is represent the object to be constructed.</span>
<span class="sd">        subpath : str</span>
<span class="sd">            The `name` of `h5gr` with a ``&#39;/&#39;`` in the end.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obj : cls</span>
<span class="sd">            Newly generated class instance containing the required data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># for new implementations, use:</span>
        <span class="c1">#   obj = cls.__new__(cls)                     # create class instance, no __init__() call</span>
        <span class="c1">#   hdf5_loader.memorize(h5gr, obj)            # call preferably before loading other data</span>
        <span class="c1">#   info = hdf5_loader.get_attr(h5gr, &quot;name&quot;)  # for metadata</span>
        <span class="c1">#   data = hdf5_loader.load(subpath + &quot;key&quot;)   # for big content/data</span>

        <span class="n">dict_format</span> <span class="o">=</span> <span class="n">hdf5_loader</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="n">h5gr</span><span class="p">,</span> <span class="n">ATTR_FORMAT</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>  <span class="c1"># create class instance, no __init__() call</span>
        <span class="n">hdf5_loader</span><span class="o">.</span><span class="n">memorize</span><span class="p">(</span><span class="n">h5gr</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>  <span class="c1"># call preferably before loading other data</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">hdf5_loader</span><span class="o">.</span><span class="n">load_dict</span><span class="p">(</span><span class="n">h5gr</span><span class="p">,</span> <span class="n">dict_format</span><span class="p">,</span> <span class="n">subpath</span><span class="p">)</span>  <span class="c1"># specialized loading</span>
        <span class="c1"># (the `load_dict` did not overwrite the memo entry)</span>
        <span class="n">obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># store data in the object</span>
        <span class="k">return</span> <span class="n">obj</span></div></div>


<div class="viewcode-block" id="Hdf5Saver"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Saver.html#tenpy.networks.site.Hdf5Saver">[docs]</a><span class="k">class</span> <span class="nc">Hdf5Saver</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Engine to save simple enough objects into a HDF5 file.</span>

<span class="sd">    The intended use of this class is through :func:`dump_to_hdf5`, which is simply an alias</span>
<span class="sd">    for ``Hdf5Saver(h5group).dump(obj, path)``.</span>

<span class="sd">    It exports python objects to a HDF5 file such that they can be loaded with the</span>
<span class="sd">    :class:`Hdf5Loader`, or a call to :func:`load_from_hdf5`, respectively.</span>

<span class="sd">    The basic structure of this class is similar as the `Pickler` from :mod:`pickle`.</span>

<span class="sd">    See :doc:`/intro/input_output` for a specification of what can be dumped and what the resulting</span>
<span class="sd">    datastructure is.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    h5group : :class:`Group`</span>
<span class="sd">        The HDF5 group (or HDF5 :class:`File`) where to save the data.</span>
<span class="sd">    format_selection : dict</span>
<span class="sd">        This dictionary allows to set a output format selection for user-defined</span>
<span class="sd">        :meth:`Hdf5Exportable.save_hdf5` implementations.</span>
<span class="sd">        For example, :class:`~tenpy.linalg.LegCharge` checks it for the key ``&quot;LegCharge&quot;``.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    h5group : :class:`Group`</span>
<span class="sd">        The HDF5 group (or HDF5 :class:`File`) where to save the data.</span>
<span class="sd">    dispatch : dict</span>
<span class="sd">        Mapping from a type `keytype` to methods `f` of this class.</span>
<span class="sd">        The method is called as ``f(self, obj, path, type_repr)``.</span>
<span class="sd">        The call to `f` should save the object `obj` in ``self.h5group[path]``,</span>
<span class="sd">        call :meth:`memorize`, and set ``h5gr.attr[ATTR_TYPE] = type_repr``</span>
<span class="sd">        to a string `type_repr` in order to allow loading with the dispatcher</span>
<span class="sd">        in ``Hdf5Loader.dispatch[type_repr]``.</span>
<span class="sd">    memo : dict</span>
<span class="sd">        A dictionary to remember all the objects which we already stored to :attr:`h5group`.</span>
<span class="sd">        The dictionary keys are object ids; the values are two-tuples of the hdf5 group or dataset</span>
<span class="sd">        where an object was stored, and the object itself. See :meth:`memorize`.</span>
<span class="sd">    format_selection : dict</span>
<span class="sd">        This dictionary allows to set a output format selection for user-defined</span>
<span class="sd">        :meth:`Hdf5Exportable.save_hdf5` implementations.</span>
<span class="sd">        For example, :class:`~tenpy.linalg.LegCharge` checks it for the key ``&quot;LegCharge&quot;``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5group</span><span class="p">,</span> <span class="n">format_selection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h5group</span> <span class="o">=</span> <span class="n">h5group</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memo</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">format_selection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">format_selection</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format_selection</span> <span class="o">=</span> <span class="n">format_selection</span>

<div class="viewcode-block" id="Hdf5Saver.dump"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Saver.html#tenpy.networks.site.Hdf5Saver.dump">[docs]</a>    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save `obj` in ``self.h5group[path]``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : object</span>
<span class="sd">            The object (=data) to be saved.</span>
<span class="sd">        path : str</span>
<span class="sd">            Path within `h5group` under which the `obj` should be saved.</span>
<span class="sd">            To avoid unwanted overwriting of important data, the group/object should not yet exist,</span>
<span class="sd">            except if `path` is the default ``&#39;/&#39;``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        h5gr : :class:`Group` | :class:`Dataset`</span>
<span class="sd">            The h5py group or dataset in which `obj` was saved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj_id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">in_memo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">obj_id</span><span class="p">)</span>  <span class="c1"># default=None</span>
        <span class="k">if</span> <span class="n">in_memo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># saved the object before</span>
            <span class="n">h5gr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">in_memo</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">h5group</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">h5gr</span>  <span class="c1"># create hdf5 hard link</span>
            <span class="c1"># hard linked objects share an hdf5 id,</span>
            <span class="c1"># which we use in the loader to distinguish them</span>
            <span class="k">return</span> <span class="n">h5gr</span>

        <span class="n">disp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">disp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span><span class="p">,</span> <span class="n">type_repr</span> <span class="o">=</span> <span class="n">disp</span>
            <span class="c1"># `f` is a dispatcher function, which should</span>
            <span class="c1"># - save the `obj` in self.h5group[&#39;path&#39;],</span>
            <span class="c1"># - call :meth:`memorize`, and</span>
            <span class="c1"># - set ``h5gr.attr[ATTR_TYPE] = type_repr`` to a string `type_repr`</span>
            <span class="c1">#   to allow loading with the dispatcher ``Hdf5Loader.dispatch[type_repr]``</span>
            <span class="c1"># call unbound method `f` with explicit self</span>
            <span class="n">h5gr</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">type_repr</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">h5gr</span>

        <span class="c1"># handle classes with `save_hdf5` method</span>
        <span class="n">obj_save_hdf5</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;save_hdf5&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">obj_save_hdf5</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># of Hdf5Exportable type</span>
            <span class="c1"># `obj_save_hdf5` should be the bound method `obj.save_hdf5`,</span>
            <span class="c1"># so it does not need an explicit reference of `obj`</span>
            <span class="n">h5gr</span><span class="p">,</span> <span class="n">subpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_group_for_obj</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
            <span class="n">h5gr</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">ATTR_TYPE</span><span class="p">]</span> <span class="o">=</span> <span class="n">REPR_HDF5EXPORTABLE</span>
            <span class="n">h5gr</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">ATTR_CLASS</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="vm">__qualname__</span>
            <span class="n">h5gr</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">ATTR_MODULE</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="vm">__module__</span>
            <span class="n">obj_save_hdf5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5gr</span><span class="p">,</span> <span class="n">subpath</span><span class="p">)</span>  <span class="c1"># should save the actual data</span>
            <span class="k">return</span> <span class="n">h5gr</span>

        <span class="c1"># unknown case</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Don&#39;t know how to dump object of type </span><span class="si">{0!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">Hdf5ExportError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="Hdf5Saver.create_group_for_obj"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Saver.html#tenpy.networks.site.Hdf5Saver.create_group_for_obj">[docs]</a>    <span class="k">def</span> <span class="nf">create_group_for_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create an HDF5 group ``self.h5group[path]`` to store `obj`.</span>

<span class="sd">        Also handle ending of path with ``&#39;/&#39;``, and memorize `obj` in the :attr:`memo`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">            Path within `h5group` under which the `obj` should be saved.</span>
<span class="sd">            To avoid unwanted overwriting of important data, the group/object should not yet exist,</span>
<span class="sd">            except if `path` is the default ``&#39;/&#39;``.</span>
<span class="sd">        obj : object</span>
<span class="sd">            The object (=data) to be saved.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        h5group : :class:`Group`</span>
<span class="sd">            Newly created h5py (sub)group ``self.h5group[path]``, unless `path` is ``&#39;/&#39;``,</span>
<span class="sd">            in which case it is simply the existing ``self.h5group[&#39;/&#39;]``.</span>
<span class="sd">        subpath : str</span>
<span class="sd">            The `group.name` ending with ``&#39;/&#39;``, such that other names can be appended to</span>
<span class="sd">            get the path for subgroups or datasets in the group.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError : if `self.h5group[path]`` already existed and `path` is not ``&#39;/&#39;``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
            <span class="n">gr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5group</span><span class="p">[</span><span class="n">path</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5group</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>  <span class="c1"># raises ValueError if path already exists.</span>
        <span class="n">subpath</span> <span class="o">=</span> <span class="n">path</span> <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span> <span class="k">else</span> <span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memorize</span><span class="p">(</span><span class="n">gr</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gr</span><span class="p">,</span> <span class="n">subpath</span></div>

<div class="viewcode-block" id="Hdf5Saver.memorize"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Saver.html#tenpy.networks.site.Hdf5Saver.memorize">[docs]</a>    <span class="k">def</span> <span class="nf">memorize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5gr</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Store objects already saved in the :attr:`memo`.</span>

<span class="sd">        This allows to avoid copies, if the same python object appears multiple times in the</span>
<span class="sd">        data of `obj`. Examples can be shared :class:`~tenpy.linalg.charges.LegCharge` objects</span>
<span class="sd">        or even shared :class:`~tenpy.linalg.np_conserved.Array`.</span>
<span class="sd">        Using the memo also avoids crashes from cyclic references,</span>
<span class="sd">        e.g., when a list contains a reference to itself.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        h5gr : :class:`Group` | :class:`Dataset`</span>
<span class="sd">            The h5py group or dataset in which `obj` was saved.</span>
<span class="sd">        obj : :class:`object`</span>
<span class="sd">            The object saved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj_id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">obj_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">memo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memo</span><span class="p">[</span><span class="n">obj_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">h5gr</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span></div>

    <span class="n">dispatch</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># the methods below are used in the dispatch table</span>

<div class="viewcode-block" id="Hdf5Saver.save_none"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Saver.html#tenpy.networks.site.Hdf5Saver.save_none">[docs]</a>    <span class="k">def</span> <span class="nf">save_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">type_repr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save the None object as a string (dataset); in dispatch table.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h5group</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">REPR_NONE</span>
        <span class="n">h5gr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5group</span><span class="p">[</span><span class="n">path</span><span class="p">]</span>
        <span class="n">h5gr</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">ATTR_TYPE</span><span class="p">]</span> <span class="o">=</span> <span class="n">REPR_NONE</span>
        <span class="k">return</span> <span class="n">h5gr</span></div>

    <span class="n">dispatch</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">save_none</span><span class="p">,</span> <span class="n">REPR_NONE</span><span class="p">)</span>

<div class="viewcode-block" id="Hdf5Saver.save_dataset"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Saver.html#tenpy.networks.site.Hdf5Saver.save_dataset">[docs]</a>    <span class="k">def</span> <span class="nf">save_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">type_repr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save `obj` as a hdf5 dataset; in dispatch table.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h5group</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>  <span class="c1"># save as dataset</span>
        <span class="n">h5gr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5group</span><span class="p">[</span><span class="n">path</span><span class="p">]</span>
        <span class="n">h5gr</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">ATTR_TYPE</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_repr</span>
        <span class="k">return</span> <span class="n">h5gr</span></div>

    <span class="k">for</span> <span class="n">_t</span><span class="p">,</span> <span class="n">_type_repr</span> <span class="ow">in</span> <span class="n">TYPES_FOR_HDF5_DATASETS</span><span class="p">:</span>
        <span class="n">dispatch</span><span class="p">[</span><span class="n">_t</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">save_dataset</span><span class="p">,</span> <span class="n">_type_repr</span><span class="p">)</span>

<div class="viewcode-block" id="Hdf5Saver.save_iterable"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Saver.html#tenpy.networks.site.Hdf5Saver.save_iterable">[docs]</a>    <span class="k">def</span> <span class="nf">save_iterable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">type_repr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save an iterable `obj` like a list, tuple or set; in dispatch table.&quot;&quot;&quot;</span>
        <span class="n">h5gr</span><span class="p">,</span> <span class="n">subpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_group_for_obj</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="n">h5gr</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">ATTR_TYPE</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_repr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_iterable_content</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">h5gr</span><span class="p">,</span> <span class="n">subpath</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">h5gr</span></div>

    <span class="n">dispatch</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">save_iterable</span><span class="p">,</span> <span class="n">REPR_LIST</span><span class="p">)</span>
    <span class="n">dispatch</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">save_iterable</span><span class="p">,</span> <span class="n">REPR_TUPLE</span><span class="p">)</span>
    <span class="n">dispatch</span><span class="p">[</span><span class="nb">set</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">save_iterable</span><span class="p">,</span> <span class="n">REPR_SET</span><span class="p">)</span>

<div class="viewcode-block" id="Hdf5Saver.save_iterable_content"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Saver.html#tenpy.networks.site.Hdf5Saver.save_iterable_content">[docs]</a>    <span class="k">def</span> <span class="nf">save_iterable_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">h5gr</span><span class="p">,</span> <span class="n">subpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save contents of an iterable `obj` in the existing `h5gr`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : dict</span>
<span class="sd">            The data to be saved</span>
<span class="sd">        h5gr : :class:`Group`</span>
<span class="sd">            h5py Group under which the keys and values of `obj` should be saved.</span>
<span class="sd">        subpath : str</span>
<span class="sd">            Name of h5gr with ``&#39;/&#39;`` in the end.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">h5gr</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">ATTR_LEN</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">subpath</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span></div>

<div class="viewcode-block" id="Hdf5Saver.save_dict"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Saver.html#tenpy.networks.site.Hdf5Saver.save_dict">[docs]</a>    <span class="k">def</span> <span class="nf">save_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">type_repr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save the dictionary `obj`; in dispatch table.&quot;&quot;&quot;</span>
        <span class="n">h5gr</span><span class="p">,</span> <span class="n">subpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_group_for_obj</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="n">type_repr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_dict_content</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">h5gr</span><span class="p">,</span> <span class="n">subpath</span><span class="p">)</span>
        <span class="n">h5gr</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">ATTR_TYPE</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_repr</span>
        <span class="k">return</span> <span class="n">h5gr</span></div>

    <span class="n">dispatch</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">save_dict</span><span class="p">,</span> <span class="n">REPR_DICT</span><span class="p">)</span>

<div class="viewcode-block" id="Hdf5Saver.save_dict_content"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Saver.html#tenpy.networks.site.Hdf5Saver.save_dict_content">[docs]</a>    <span class="k">def</span> <span class="nf">save_dict_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">h5gr</span><span class="p">,</span> <span class="n">subpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save contents of a dictionary `obj` in the existing `h5gr`.</span>

<span class="sd">        The format depends on whether the dictionary `obj` has simple keys (only strings which are</span>
<span class="sd">        valid python variable names) or not.</span>
<span class="sd">        For simple keys: directly use the keys as path.</span>
<span class="sd">        For non-simple keys: save list of keys und ``&quot;keys&quot;`` and list of values und ``&quot;values&quot;``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : dict</span>
<span class="sd">            The data to be saved</span>
<span class="sd">        h5gr : :class:`Group`</span>
<span class="sd">            h5py Group under which the keys and values of `obj` should be saved.</span>
<span class="sd">        subpath : str</span>
<span class="sd">            Name of h5gr with ``&#39;/&#39;`` in the end.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        type_repr : REPR_DICT | REPR_DICT_SIMPLE</span>
<span class="sd">            Indicates whether the data was saved in the format for a dictionary with simple keys</span>
<span class="sd">            (i.e., using the keys for paths of hdf5 subgroups and datasets) or general keys</span>
<span class="sd">            (i.e., saving keys and values separately).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if we have only simple keys, which we can use in `path`</span>
        <span class="n">simple_keys</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">isidentifier</span><span class="p">():</span>
                <span class="c1"># isidentifier checks that `k` is a valid name for a python variable, which</span>
                <span class="c1"># is sufficiently simple to allow using them in the `path` for the hdf5</span>
                <span class="c1"># dataset (in particular, it does not contain &#39;/&#39; creating unwanted subgroups).</span>
                <span class="n">simple_keys</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">simple_keys</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">subpath</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">REPR_DICT_SIMPLE</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_iterable</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">subpath</span> <span class="o">+</span> <span class="s2">&quot;keys&quot;</span><span class="p">,</span> <span class="n">REPR_LIST</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_iterable</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">subpath</span> <span class="o">+</span> <span class="s2">&quot;values&quot;</span><span class="p">,</span> <span class="n">REPR_LIST</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">REPR_DICT</span></div>

<div class="viewcode-block" id="Hdf5Saver.save_range"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Saver.html#tenpy.networks.site.Hdf5Saver.save_range">[docs]</a>    <span class="k">def</span> <span class="nf">save_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">type_repr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save a range object; in dispatch table.&quot;&quot;&quot;</span>
        <span class="n">h5gr</span><span class="p">,</span> <span class="n">subpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_group_for_obj</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="n">h5gr</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">ATTR_TYPE</span><span class="p">]</span> <span class="o">=</span> <span class="n">REPR_RANGE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">subpath</span> <span class="o">+</span> <span class="s1">&#39;start&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="n">subpath</span> <span class="o">+</span> <span class="s1">&#39;stop&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="n">subpath</span> <span class="o">+</span> <span class="s1">&#39;step&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">h5gr</span></div>

    <span class="n">dispatch</span><span class="p">[</span><span class="nb">range</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">save_range</span><span class="p">,</span> <span class="n">REPR_RANGE</span><span class="p">)</span>

<div class="viewcode-block" id="Hdf5Saver.save_dtype"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Saver.html#tenpy.networks.site.Hdf5Saver.save_dtype">[docs]</a>    <span class="k">def</span> <span class="nf">save_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">type_repr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save a :class:`~numpy.dtype` object; in dispatch table.&quot;&quot;&quot;</span>
        <span class="n">h5gr</span><span class="p">,</span> <span class="n">subpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_group_for_obj</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="n">h5gr</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">ATTR_TYPE</span><span class="p">]</span> <span class="o">=</span> <span class="n">REPR_DTYPE</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;void&quot;</span><span class="p">)</span>
        <span class="n">h5gr</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">descr</span><span class="p">,</span> <span class="n">subpath</span> <span class="o">+</span> <span class="s1">&#39;descr&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">h5gr</span></div>

    <span class="n">dispatch</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">save_dtype</span><span class="p">,</span> <span class="n">REPR_DTYPE</span><span class="p">)</span>

    <span class="c1"># clean up temporary variables</span>
    <span class="k">del</span> <span class="n">_t</span>
    <span class="k">del</span> <span class="n">_type_repr</span></div>


<div class="viewcode-block" id="Hdf5Loader"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Loader.html#tenpy.networks.site.Hdf5Loader">[docs]</a><span class="k">class</span> <span class="nc">Hdf5Loader</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Class to load and import object from a HDF5 file.</span>

<span class="sd">    The intended use of this class is through :func:`load_from_hdf5`, which is simply an alias</span>
<span class="sd">    for ``Hdf5Loader(h5group).load(path)``.</span>

<span class="sd">    It can load data exported with :func:`dump_to_hdf5` or the :class:`Hdf5Saver`, respectively.</span>

<span class="sd">    The basic structure of this class is similar as the `Unpickler` from :mod:`pickle`.</span>

<span class="sd">    See :doc:`/intro/input_output` for a specification of what can be dumped and what the resulting</span>
<span class="sd">    datastructure is.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    h5group : :class:`Group`</span>
<span class="sd">        The HDF5 group (or file) where to save the data.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    h5group : :class:`Group`</span>
<span class="sd">        The HDF5 group (or HDF5 :class:`File`) where to save the data.</span>
<span class="sd">    dispatch : dict</span>
<span class="sd">        Mapping from a :class:`np.string_`, which is one of the global ``REPR_*`` variables,</span>
<span class="sd">        to methods `f` of this class.</span>
<span class="sd">        The method is called as ``f(self, h5gr, type_info, subpath)``.</span>
<span class="sd">        The call to `f` should load and return an object `obj` from the h5py :class:`Group`</span>
<span class="sd">        or :class:`Dataset` `h5gr`; and memorize the loaded `obj` with :meth:`memorize`.</span>
<span class="sd">        `subpath` is just the name of `h5gr` with a guaranteed ``&#39;/&#39;`` in the end.</span>
<span class="sd">        `type_info` is often the ``REPR_*`` variable of the type or some other information about</span>
<span class="sd">        the type, which allows to use a single dispatch function for different datatypes.</span>
<span class="sd">    memo : dict</span>
<span class="sd">        A dictionary to remember all the objects which we already loaded from :attr:`h5group`.</span>
<span class="sd">        The dictionary keys are h5py Group- or dataset ``id``;</span>
<span class="sd">        the values are the loaded objects. See :meth:`memorize`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5group</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h5group</span> <span class="o">=</span> <span class="n">h5group</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memo</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="Hdf5Loader.load"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Loader.html#tenpy.networks.site.Hdf5Loader.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load a Python :class:`object` from the dataset.</span>

<span class="sd">        See :func:`load_from_hdf5` for more details.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : None | str | :class:`Reference`</span>
<span class="sd">            Path within :attr:`h5group` to be used for loading.</span>
<span class="sd">            Defaults to the name of :attr:`h5group` itself.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obj : object</span>
<span class="sd">            The Python object loaded from `h5group` (specified by `path`).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get dataset to be loaded</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">h5gr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5group</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5group</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">h5gr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5group</span><span class="p">[</span><span class="n">path</span><span class="p">]</span>
        <span class="n">subpath</span> <span class="o">=</span> <span class="n">path</span> <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span> <span class="k">else</span> <span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="c1"># check memo</span>
        <span class="n">in_memo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">h5gr</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>  <span class="c1"># default=None</span>
        <span class="k">if</span> <span class="n">in_memo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># loaded the object before</span>
            <span class="k">return</span> <span class="n">in_memo</span>

        <span class="c1"># determine type of object to be loaded.</span>
        <span class="n">type_repr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="n">h5gr</span><span class="p">,</span> <span class="n">ATTR_TYPE</span><span class="p">))</span>
        <span class="n">disp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">type_repr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">disp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Unknown type </span><span class="si">{0!r}</span><span class="s2"> while loading hdf5 dataset </span><span class="si">{1!s}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="n">Hdf5ImportError</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">type_repr</span><span class="p">,</span> <span class="n">h5gr</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">f</span><span class="p">,</span> <span class="n">type_info</span> <span class="o">=</span> <span class="n">disp</span>
        <span class="c1"># `f` is a dispatcher function, which should do the following</span>
        <span class="c1"># (preferably in this order, if `obj` is mutable):</span>
        <span class="c1"># - generate an object `obj` of the described type</span>
        <span class="c1"># - call :meth:`memorize` for the generated `obj`,</span>
        <span class="c1"># - fill the object with the data from subgroups/subdatasets (everything under `subpath`)</span>
        <span class="c1"># - return the generated `obj`</span>
        <span class="c1"># call unbound method `f` with explicit self</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5gr</span><span class="p">,</span> <span class="n">type_info</span><span class="p">,</span> <span class="n">subpath</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span></div>

<div class="viewcode-block" id="Hdf5Loader.memorize"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Loader.html#tenpy.networks.site.Hdf5Loader.memorize">[docs]</a>    <span class="k">def</span> <span class="nf">memorize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5gr</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Store objects already loaded in the :attr:`memo`.</span>

<span class="sd">        This allows to avoid copies, if the same dataset appears multiple times in the</span>
<span class="sd">        hdf5 group of `obj`.</span>
<span class="sd">        Examples can be shared :class:`~tenpy.linalg.charges.LegCharge` objects</span>
<span class="sd">        or even shared :class:`~tenpy.linalg.np_conserved.Array`.</span>

<span class="sd">        To handle cyclic references correctly, this function should be called *before* loading</span>
<span class="sd">        data from subgroups with new calls of :meth:`load`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memo</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">h5gr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>  <span class="c1"># don&#39;t overwrite existing entries!</span></div>

<div class="viewcode-block" id="Hdf5Loader.get_attr"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Loader.html#tenpy.networks.site.Hdf5Loader.get_attr">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_attr</span><span class="p">(</span><span class="n">h5gr</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return attribute ``h5gr.attrs[attr_name]``, if existent.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        :class:`Hdf5ImportError`</span>
<span class="sd">            If the attribute does not exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">h5gr</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;missing attribute </span><span class="si">{0!r}</span><span class="s2"> for dataset </span><span class="si">{1!s}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="n">Hdf5ImportError</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr_name</span><span class="p">,</span> <span class="n">h5gr</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="Hdf5Loader.find_class"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Loader.html#tenpy.networks.site.Hdf5Loader.find_class">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">find_class</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">classname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the class of the qualified `classname` in a given python `module`.</span>

<span class="sd">        Imports the module.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">mod</span>
        <span class="k">for</span> <span class="n">subpath</span> <span class="ow">in</span> <span class="n">classname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">cls</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subpath</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">Hdf5ImportError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t find attribute </span><span class="si">{!r}</span><span class="s2"> on </span><span class="si">{!r}</span><span class="s2"> for loading </span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">subpath</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">classname</span><span class="p">))</span> <span class="kn">from</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="bp">cls</span></div>

    <span class="n">dispatch</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># the methods below are used in the dispatch table</span>

<div class="viewcode-block" id="Hdf5Loader.load_none"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Loader.html#tenpy.networks.site.Hdf5Loader.load_none">[docs]</a>    <span class="k">def</span> <span class="nf">load_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5gr</span><span class="p">,</span> <span class="n">type_info</span><span class="p">,</span> <span class="n">subpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the ``None`` object from a dataset.&quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memorize</span><span class="p">(</span><span class="n">h5gr</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span></div>

    <span class="n">dispatch</span><span class="p">[</span><span class="n">REPR_NONE</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">load_none</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<div class="viewcode-block" id="Hdf5Loader.load_dataset"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Loader.html#tenpy.networks.site.Hdf5Loader.load_dataset">[docs]</a>    <span class="k">def</span> <span class="nf">load_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5gr</span><span class="p">,</span> <span class="n">type_info</span><span class="p">,</span> <span class="n">subpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load a h5py :class:`Dataset` and convert it into the desired type.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">type_info</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">h5gr</span><span class="p">[</span><span class="o">...</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">h5gr</span><span class="p">[()]</span>  <span class="c1"># load scalar from hdf5 Dataset</span>
            <span class="c1"># convert to desired type: type_info is simply the type</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">type_info</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memorize</span><span class="p">(</span><span class="n">h5gr</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span></div>

    <span class="k">for</span> <span class="n">_t</span><span class="p">,</span> <span class="n">_type_repr</span> <span class="ow">in</span> <span class="n">TYPES_FOR_HDF5_DATASETS</span><span class="p">:</span>
        <span class="n">dispatch</span><span class="p">[</span><span class="n">_type_repr</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">load_dataset</span><span class="p">,</span> <span class="n">_t</span><span class="p">)</span>

<div class="viewcode-block" id="Hdf5Loader.load_list"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Loader.html#tenpy.networks.site.Hdf5Loader.load_list">[docs]</a>    <span class="k">def</span> <span class="nf">load_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5gr</span><span class="p">,</span> <span class="n">type_info</span><span class="p">,</span> <span class="n">subpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load a list.&quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memorize</span><span class="p">(</span><span class="n">h5gr</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="n">h5gr</span><span class="p">,</span> <span class="n">ATTR_LEN</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
            <span class="n">sub_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">subpath</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span></div>

    <span class="n">dispatch</span><span class="p">[</span><span class="n">REPR_LIST</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">load_list</span><span class="p">,</span> <span class="n">REPR_LIST</span><span class="p">)</span>

<div class="viewcode-block" id="Hdf5Loader.load_set"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Loader.html#tenpy.networks.site.Hdf5Loader.load_set">[docs]</a>    <span class="k">def</span> <span class="nf">load_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5gr</span><span class="p">,</span> <span class="n">type_info</span><span class="p">,</span> <span class="n">subpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load a set.&quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memorize</span><span class="p">(</span><span class="n">h5gr</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="n">h5gr</span><span class="p">,</span> <span class="n">ATTR_LEN</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
            <span class="n">sub_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">subpath</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sub_obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span></div>

    <span class="n">dispatch</span><span class="p">[</span><span class="n">REPR_SET</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">load_set</span><span class="p">,</span> <span class="n">REPR_SET</span><span class="p">)</span>

<div class="viewcode-block" id="Hdf5Loader.load_tuple"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Loader.html#tenpy.networks.site.Hdf5Loader.load_tuple">[docs]</a>    <span class="k">def</span> <span class="nf">load_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5gr</span><span class="p">,</span> <span class="n">type_info</span><span class="p">,</span> <span class="n">subpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load a tuple.&quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># tuple is immutable: can&#39;t append to it</span>
        <span class="c1"># so we need to use a list during loading</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memorize</span><span class="p">(</span><span class="n">h5gr</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="c1"># BUG: for recursive tuples, the memorized object is a list instead of a tuple.</span>
        <span class="c1"># but I don&#39;t know how to circumvent this.</span>
        <span class="c1"># It&#39;s hopefully not relevant for our applications.</span>
        <span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="n">h5gr</span><span class="p">,</span> <span class="n">ATTR_LEN</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
            <span class="n">sub_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">subpath</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_obj</span><span class="p">)</span>
        <span class="c1"># now conjvert the list to tuple</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memo</span><span class="p">[</span><span class="n">h5gr</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>  <span class="c1"># overwrite the memo entry to point to the tuple, not the list</span>
        <span class="k">return</span> <span class="n">obj</span></div>

    <span class="n">dispatch</span><span class="p">[</span><span class="n">REPR_TUPLE</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">load_tuple</span><span class="p">,</span> <span class="n">REPR_TUPLE</span><span class="p">)</span>

<div class="viewcode-block" id="Hdf5Loader.load_dict"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Loader.html#tenpy.networks.site.Hdf5Loader.load_dict">[docs]</a>    <span class="k">def</span> <span class="nf">load_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5gr</span><span class="p">,</span> <span class="n">type_info</span><span class="p">,</span> <span class="n">subpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load a dictionary in the format according to `type_info`.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">type_info</span> <span class="o">==</span> <span class="n">REPR_DICT</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_general_dict</span><span class="p">(</span><span class="n">h5gr</span><span class="p">,</span> <span class="n">type_info</span><span class="p">,</span> <span class="n">subpath</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">type_info</span> <span class="o">==</span> <span class="n">REPR_DICT_SIMPLE</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_simple_dict</span><span class="p">(</span><span class="n">h5gr</span><span class="p">,</span> <span class="n">type_info</span><span class="p">,</span> <span class="n">subpath</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;can&#39;t interpret type_info </span><span class="si">{0!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">type_info</span><span class="p">))</span></div>

<div class="viewcode-block" id="Hdf5Loader.load_general_dict"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Loader.html#tenpy.networks.site.Hdf5Loader.load_general_dict">[docs]</a>    <span class="k">def</span> <span class="nf">load_general_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5gr</span><span class="p">,</span> <span class="n">type_info</span><span class="p">,</span> <span class="n">subpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load a dictionary with general keys.&quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memorize</span><span class="p">(</span><span class="n">h5gr</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_list</span><span class="p">(</span><span class="n">h5gr</span><span class="p">[</span><span class="s1">&#39;keys&#39;</span><span class="p">],</span> <span class="n">REPR_LIST</span><span class="p">,</span> <span class="n">subpath</span> <span class="o">+</span> <span class="s1">&#39;keys/&#39;</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_list</span><span class="p">(</span><span class="n">h5gr</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">],</span> <span class="n">REPR_LIST</span><span class="p">,</span> <span class="n">subpath</span> <span class="o">+</span> <span class="s1">&#39;values/&#39;</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">values</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">obj</span></div>

    <span class="n">dispatch</span><span class="p">[</span><span class="n">REPR_DICT</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">load_general_dict</span><span class="p">,</span> <span class="n">REPR_DICT</span><span class="p">)</span>

<div class="viewcode-block" id="Hdf5Loader.load_simple_dict"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Loader.html#tenpy.networks.site.Hdf5Loader.load_simple_dict">[docs]</a>    <span class="k">def</span> <span class="nf">load_simple_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5gr</span><span class="p">,</span> <span class="n">type_info</span><span class="p">,</span> <span class="n">subpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load a dictionary with simple keys.&quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memorize</span><span class="p">(</span><span class="n">h5gr</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">h5gr</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">subpath</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span>
            <span class="n">obj</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">return</span> <span class="n">obj</span></div>

    <span class="n">dispatch</span><span class="p">[</span><span class="n">REPR_DICT_SIMPLE</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">load_simple_dict</span><span class="p">,</span> <span class="n">REPR_DICT_SIMPLE</span><span class="p">)</span>

<div class="viewcode-block" id="Hdf5Loader.load_range"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Loader.html#tenpy.networks.site.Hdf5Loader.load_range">[docs]</a>    <span class="k">def</span> <span class="nf">load_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5gr</span><span class="p">,</span> <span class="n">type_info</span><span class="p">,</span> <span class="n">subpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load a range.&quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">subpath</span> <span class="o">+</span> <span class="s1">&#39;start&#39;</span><span class="p">)</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">subpath</span> <span class="o">+</span> <span class="s1">&#39;stop&#39;</span><span class="p">)</span>
        <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">subpath</span> <span class="o">+</span> <span class="s1">&#39;step&#39;</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memorize</span><span class="p">(</span><span class="n">h5gr</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>  <span class="c1"># late, but subgroups should only be int&#39;s; no cyclic reference</span>
        <span class="k">return</span> <span class="n">obj</span></div>

    <span class="n">dispatch</span><span class="p">[</span><span class="n">REPR_RANGE</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">load_range</span><span class="p">,</span> <span class="n">REPR_RANGE</span><span class="p">)</span>

<div class="viewcode-block" id="Hdf5Loader.load_dtype"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Loader.html#tenpy.networks.site.Hdf5Loader.load_dtype">[docs]</a>    <span class="k">def</span> <span class="nf">load_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5gr</span><span class="p">,</span> <span class="n">type_info</span><span class="p">,</span> <span class="n">subpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load a :class:`numpy.dtype`.&quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="n">h5gr</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;void&quot;</span><span class="p">):</span>
            <span class="n">descr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">subpath</span> <span class="o">+</span> <span class="s1">&#39;descr&#39;</span><span class="p">)</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">descr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memorize</span><span class="p">(</span><span class="n">h5gr</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span></div>

    <span class="n">dispatch</span><span class="p">[</span><span class="n">REPR_DTYPE</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">load_dtype</span><span class="p">,</span> <span class="n">REPR_DTYPE</span><span class="p">)</span>

<div class="viewcode-block" id="Hdf5Loader.load_hdf5exportable"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.Hdf5Loader.html#tenpy.networks.site.Hdf5Loader.load_hdf5exportable">[docs]</a>    <span class="k">def</span> <span class="nf">load_hdf5exportable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5gr</span><span class="p">,</span> <span class="n">type_info</span><span class="p">,</span> <span class="n">subpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load an instance of a userdefined class.&quot;&quot;&quot;</span>
        <span class="n">modulename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="n">h5gr</span><span class="p">,</span> <span class="n">ATTR_MODULE</span><span class="p">)</span>
        <span class="n">classname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="n">h5gr</span><span class="p">,</span> <span class="n">ATTR_CLASS</span><span class="p">)</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_class</span><span class="p">(</span><span class="n">modulename</span><span class="p">,</span> <span class="n">classname</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_hdf5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5gr</span><span class="p">,</span> <span class="n">subpath</span><span class="p">)</span></div>

    <span class="n">dispatch</span><span class="p">[</span><span class="n">REPR_HDF5EXPORTABLE</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">load_hdf5exportable</span><span class="p">,</span> <span class="n">REPR_HDF5EXPORTABLE</span><span class="p">)</span>

    <span class="c1"># clean up temporary variables</span>
    <span class="k">del</span> <span class="n">_t</span>
    <span class="k">del</span> <span class="n">_type_repr</span></div>


<div class="viewcode-block" id="dump_to_hdf5"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.dump_to_hdf5.html#tenpy.networks.site.dump_to_hdf5">[docs]</a><span class="k">def</span> <span class="nf">dump_to_hdf5</span><span class="p">(</span><span class="n">h5group</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Save an object `obj` into a hdf5 file or group.</span>

<span class="sd">    Roughly equivalent to ``h5group[path] = obj``, but handle different types of `obj`.</span>
<span class="sd">    For example, dictionaries are handled recursively.</span>
<span class="sd">    See :doc:`/intro/input_output` for a specification of what can be dumped and what the resulting</span>
<span class="sd">    datastructure is.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    h5group : :class:`Group`</span>
<span class="sd">        The HDF5 group (or h5py :class:`File`) to which `obj` should be saved.</span>
<span class="sd">    obj : object</span>
<span class="sd">        The object (=data) to be saved.</span>
<span class="sd">    path : str</span>
<span class="sd">        Path within `h5group` under which the `obj` should be saved.</span>
<span class="sd">        To avoid unwanted overwriting of important data, the group/object should not yet exist,</span>
<span class="sd">        except if `path` is the default ``&#39;/&#39;``.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    h5obj : :class:`Group` | :class:`Dataset`</span>
<span class="sd">        The h5py group or dataset under which `obj` was saved.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Hdf5Saver</span><span class="p">(</span><span class="n">h5group</span><span class="p">)</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></div>


<div class="viewcode-block" id="load_from_hdf5"><a class="viewcode-back" href="../../../reference/tenpy.tools.io.load_from_hdf5.html#tenpy.networks.site.load_from_hdf5">[docs]</a><span class="k">def</span> <span class="nf">load_from_hdf5</span><span class="p">(</span><span class="n">h5group</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Load an object from hdf5 file or group.</span>

<span class="sd">    Roughly equivalent to ``obj = h5group[path][...]``, but handle more complicated objects saved</span>
<span class="sd">    as hdf5 groups and/or datasets with :func:`dump_to_hdf5`.</span>
<span class="sd">    For example, dictionaries are handled recursively.</span>
<span class="sd">    See :doc:`/intro/input_output` for a specification of what can be dumped/loaded and what the</span>
<span class="sd">    corresponding datastructure is.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    h5group : :class:`Group`</span>
<span class="sd">        The HDF5 group (or h5py :class:`File`) to be loaded.</span>
<span class="sd">    path : None | str | :class:`Reference`</span>
<span class="sd">        Path within `h5group` to be used for loading. Defaults to the `h5group` itself specified.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    obj : object</span>
<span class="sd">        The Python object loaded from `h5group` (specified by `path`).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Hdf5Loader</span><span class="p">(</span><span class="n">h5group</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/logo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<h3><a href="../../../index.html">Table of Contents</a></h3>
<p class="caption"><span class="caption-text">User guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../INSTALL.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introductions.html">Introductions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../literature.html">Literature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../main.html">Tenpy main module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/tenpy.algorithms.html">algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/tenpy.linalg.html">linalg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/tenpy.models.html">models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/tenpy.networks.html">networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/tenpy.tools.html">tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/tenpy.version.html">version</a></li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">TeNPy 0.5.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../tenpy.html" >tenpy</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016-2019, TeNPy Developers.
      Last updated on Jan 16, 2020.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.2.
    </div>
  </body>
</html>